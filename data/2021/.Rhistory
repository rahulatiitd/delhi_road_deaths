b<- subset(b,"Crash_id","Lattitute","Longitude","Road name","Landmark")
str(c)
str(d)
lenght(files)
length(files)
i
library(dplyr)
library(readxl)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/Road crashes 2016 2017 2018 Delhi/')
files<- c("Delhi_Sanjana_2018_(1)","Delhi_Sanjana_2018_(2)", "Delhi_Suman_1017","Delhi_Suman_2016", "Delhi_Suman_2016_2_",
"Delhi_Suman_2016-3","Delhi_SUMAN_2017__2","Delhi_Suman_2017_3","Delhi_Suman_2018","Delhi_Suman_2018_2","Delhi_Suman_2018_3")
a<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="a")
b<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="b")
c<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="c")
d<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="d")
for (i in 2: length(files))
{
a<- rbind(a,read_xlsx(paste0(files[i],'.xlsm'),sheet ="a"))
b<- rbind(b,read_xlsx(paste0(files[i],'.xlsm'),sheet ="b"))
c<- rbind(c,read_xlsx(paste0(files[i],'.xlsm'),sheet ="c"))
d<- rbind(d,read_xlsx(paste0(files[i],'.xlsm'),sheet ="d"))
}
files[i]
a<- rbind(a,read_xlsx(paste0(files[i],'.xlsm'),sheet ="a"))
read_xlsx(paste0(files[i],'.xlsm')
read_xlsx(paste0(files[i],'.xlsm'),sheet ="a")
head(a)
for (i in 8: length(files))
{
a<- rbind(a,read_xlsx(paste0(files[i],'.xlsm'),sheet ="a"))
b<- rbind(b,read_xlsx(paste0(files[i],'.xlsm'),sheet ="b"))
c<- rbind(c,read_xlsx(paste0(files[i],'.xlsm'),sheet ="c"))
d<- rbind(d,read_xlsx(paste0(files[i],'.xlsm'),sheet ="d"))
}
nrow(a)
i
nrow(read_xlsx(paste0(files[7],'.xlsm'),sheet ="a"))
library(dplyr)
library(readxl)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/Road crashes 2016 2017 2018 Delhi/')
files<- c("Delhi_Sanjana_2018_(1)","Delhi_Sanjana_2018_(2)", "Delhi_Suman_1017","Delhi_Suman_2016", "Delhi_Suman_2016_2_",
"Delhi_Suman_2016-3","Delhi_SUMAN_2017__2","Delhi_Suman_2017_3","Delhi_Suman_2018","Delhi_Suman_2018_2","Delhi_Suman_2018_3")
a<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="a")
b<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="b")
c<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="c")
d<- read_xlsx(paste0(files[1],'.xlsm'),sheet ="d")
nrow(a)
for (i in 2: length(files))
{
a<- rbind(a,read_xlsx(paste0(files[i],'.xlsm'),sheet ="a"))
b<- rbind(b,read_xlsx(paste0(files[i],'.xlsm'),sheet ="b"))
c<- rbind(c,read_xlsx(paste0(files[i],'.xlsm'),sheet ="c"))
d<- rbind(d,read_xlsx(paste0(files[i],'.xlsm'),sheet ="d"))
}
i
nrow(a)
library(dplyr)
library(readxl)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/2021 Exctracted accident form Yatin')
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
vehicle1<- read_xlsx('2_Vehicle_Table_1.xlsx',sheet ="2_Vehicle_Table")
victim1<- read_xlsx('3_Victim_Table_1.xlsx',sheet ="3_Victim_Table")
crash2<- read_xlsx('1_Crash_Table_2.xlsx',sheet ="1_Crash_Table")
vehicle2<- read_xlsx('2_Vehicle_Table_2.xlsx',sheet ="2_Vehicle_Table")
victim2<- read_xlsx('3_Victim_Table_2.xlsx',sheet ="3_Victim_Table")
crash3<- read_xlsx('1_Crash_Table_3.xlsx',sheet ="1_Crash_Table")
vehicle3<- read_xlsx('2_Vehicle_Table_3.xlsx',sheet ="2_Vehicle_Table")
victim3<- read_xlsx('3_Victim_Table_3.xlsx',sheet ="3_Victim_Table")
crash4<- read_xlsx('1_Crash_Table_4.xlsx',sheet ="1_Crash_Table")
vehicle4<- read_xlsx('2_Vehicle_Table_4.xlsx',sheet ="2_Vehicle_Table")
victim4<- read_xlsx('3_Victim_Table_4.xlsx',sheet ="3_Victim_Table")
##assigning crash_ID to vehicle and victim files
crash1$Crash_ID_new<- paste0(crash1$Crash_ID,crash1$FIR_No, crash1$Police_Station)
crash1_lookup<- subset(crash1, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle1<- vehicle1 %>% left_join(crash1_lookup, by="Crash_ID")
victim1<- victim1 %>% left_join(crash1_lookup, by="Crash_ID")
crash2$Crash_ID_new<- paste0(crash2$Crash_ID,crash2$FIR_No, crash2$Police_Station)
crash2_lookup<- subset(crash2, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle2<- vehicle2 %>% left_join(crash2_lookup, by="Crash_ID")
victim2<- victim2 %>% left_join(crash2_lookup, by="Crash_ID")
crash3$Crash_ID_new<- paste0(crash3$Crash_ID,crash3$FIR_No, crash3$Police_Station)
crash3_lookup<- subset(crash3, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle3<- vehicle3 %>% left_join(crash3_lookup, by="Crash_ID")
victim3<- victim3 %>% left_join(crash3_lookup, by="Crash_ID")
crash4$Crash_ID_new<- paste0(crash4$Crash_ID,crash4$FIR_No, crash4$Police_Station)
crash4_lookup<- subset(crash4, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle4<- vehicle4 %>% left_join(crash4_lookup, by="Crash_ID")
victim4<- victim4 %>% left_join(crash4_lookup, by="Crash_ID")
crash<- rbind(crash1, crash2,crash3,crash4)
vehicle<- rbind(vehicle1, vehicle2,vehicle3,vehicle4)
victim<- rbind(victim1, victim2,victim3,victim4)
#assigning crash_ID to those vehicle where it is not available
x<-unique(vehicle$Vehicle_ID[which(is.na(vehicle$Crash_ID))])
victim$Crash_ID_new[which(victim$Vehicle_ID %in% x)]
##reading file that has police station names and districts
pstation<- read.csv("PS_lookup.csv")
#joining crash file with police station look up file for district, state and police station names (for Raipur and Balod)
colnames(pstation)[1]<-"Police_Station"
crash<- crash %>% left_join(pstation, by="Police_Station")
crash_lookup<- crash[,c("Crash_ID_new", "FIR_No", "Police_Station", "Time_Of_Crash", "Date_Of_Crash", "Crash_Severity", "Collision_Type", "PS_Dist", "PS_State", "PS_Name", "Note", "Road_1", "Road_2", "Road_3", "Distance_From_Landmark")]
##adding crash details to vehicle file
vehicle <- vehicle %>% left_join(crash_lookup, by="Crash_ID_new")
vehicle$Vehicle_ID_new<- paste0(vehicle$Crash_ID_new,vehicle$Vehicle_ID)
victim$Vehicle_ID_new<- paste0(victim$Crash_ID_new,victim$Vehicle_ID)
victim<- victim[,-which(colnames(victim) %in% c("Vehicle_ID", "Crash_ID", "Crash_ID_new"))]
victim <- victim %>% left_join(vehicle, by="Vehicle_ID_new")
victim$Impacting_VehOrObject[which(victim$Road_User=="Pedestrian" & victim$Impacting_VehOrObject=="Pedestrian")]<- victim$Vehicle_Type[which(victim$Road_User=="Pedestrian" & victim$Impacting_VehOrObject=="Pedestrian")]
victim$Vehicle_Type[which(victim$Road_User=="Pedestrian" )]<- "Pedestrian"
victim_f<- victim[which(victim$Injury_Category %in% c("Fatal Injury with Offsite Death","Fatal Injury with Onsite Death")),]
View(victim[,c("Crash_ID_new", "Road_User","Injury_Category", "Vehicle_Occupant_Type", "Vehicle_Type","Impacting_VehOrObject")])
View(victim_f[,c("Crash_ID_new", "Road_User","Injury_Category", "Vehicle_Occupant_Type", "Vehicle_Type","Impacting_VehOrObject")])
View(victim_f %>% group_by(Vehicle_Type) %>% summarise(n()))
crash
str(crash)
library(dplyr)
library(readxl)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/2021 Exctracted accident form Yatin')
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
str(crash1)
crash$GPS_Lat
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
head(crash1)
pstation
str(victim)
##crash file with geocodes
crash_gps<- read_xlsx('2021 FIR Delhi geocoded',sheet ="Sheet1")
##crash file with geocodes
crash_gps<- read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1")
crash_gps
victim
str(victim)
crash_gps
colnames(crash_gps)[3]<-"PS_Name"
crash_gps %>% left_join(victim_f, by="PS_Name")
View(crash_gps)
crash_gps<-crash_gps %>% left_join(victim_f, by="PS_Name")
ncol(victim_f)
ncol(crash_gps)
ncol(crash_gps)
##crash file with geocodes
crash_gps<- read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1")
ncol(crash_gps)
str(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
crash_gps %>% left_join(victim_f, by="PS_Name")
str(crash_gps)
crash_gps<-crash_gps %>% left_join(victim_f, by="PS_Name")
str(crash_gps)
nrow(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
nrow(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
crash_gps<-crash_gps %>% left_join(victim_f, by="PS_Name")
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps
victim_f$Police_Station
victim_f$PS_Name
library(stringr)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_Name
crash_gps<-crash_gps %>% left_join(victim_f, by="PS_Name")
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
crash_gps<-crash_gps %>% left_join(victim_f, by="PS_Name")
nrow(crash_gps)
str(victim_f)
str(crash_gps)
colnames(crash_gps)[2]<-"FIR_No"
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
nrow(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
nrow(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
str(crash_gps)
victim_f$PS_full<- victim_f$PS_Name
str(crash_gps)
crash_gps<- subset(crash_gps, select=c("FIR_No", "PS_Name", "Latitude", "longitude"))
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps<- subset(crash_gps, select=c("FIR_No", "PS_Name", "Latitude", "longitude"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_full<- victim_f$PS_Name
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
crash_gps
nrow(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps<- subset(crash_gps, select=c("FIR_No", "PS_Name", "Latitude", "longitude"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_full<- victim_f$PS_Name
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
crash_gps
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
ncol(crash_gps)
crash_gps<- subset(crash_gps, select=c("FIR_No", "PS_Name", "Latitude", "longitude"))
str(crash_gps
str(crash_gps)
crash_gps<- subset(crash_gps, select=c("FIR_No", "Police Station", "Latitude", "longitude"))
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps<- subset(crash_gps, select=c("FIR_No", "Police Station", "Latitude", "longitude"))
crash_gps<- subset(crash_gps, select=c("FIR_No", "Police Station", "Latitude", "Longitude"))
crash_gps<- subset(crash_gps, select=c("FIR No.", "Police Station", "Latitude", "Longitude"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_full<- victim_f$PS_Name
ncol(victim_f)
ncol(crash_gps)
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps<- subset(crash_gps, select=c("FIR No.", "Police Station", "Latitude", "Longitude"))
colnames(crash_gps)[3]<-"PS_Name"
colnames(crash_gps)[2]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_full<- victim_f$PS_Name
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
str(crash_gps)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps<- subset(crash_gps, select=c("FIR No.", "Police Station", "Latitude", "Longitude"))
colnames(crash_gps)[2]<-"PS_Name"
colnames(crash_gps)[1]<-"FIR_No"
crash_gps$FIR_No<- as.character(crash_gps$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_full<- victim_f$PS_Name
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
View(crash_gps)
View(victim_f)
unique(crash_gps$PS_Name)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps$`FIR No.`
victim_f$`FIR No.`
victim_f$FIR_No
victim_f$FIR_No<- as.character(victim_f$FIR_No)
victim_f$FIR_No<- as.double(victim_f$FIR_No)
unique(victim_f$FIR_No)
##crash file with geocodes
crash_gps<- as.data.frame(read_xlsx('2021 FIR Delhi geocoded.xlsx',sheet ="Sheet1"))
crash_gps<- subset(crash_gps, select=c("FIR No.", "Police Station", "Latitude", "Longitude"))
colnames(crash_gps)[2]<-"PS_Name"
colnames(crash_gps)[1]<-"FIR_No"
victim_f$FIR_No<- as.double(victim_f$FIR_No)
victim_f$PS_Name<- str_to_upper(victim_f$PS_Name,locale="en")
victim_f$PS_full<- victim_f$PS_Name
crash_gps<-crash_gps %>% left_join(victim_f, by=c("FIR_No","PS_Name"))
sum(is.na(crash_gps$Victim_ID))
victim_f$PS_Name
unique(victim_f$PS_Name)
order(unique(victim_f$PS_Name))
victim_f$PS_Name[order(unique(victim_f$PS_Name))]
unique(victim_f$PS_Name[order(victim_f$PS_Name)])
pstation
library(dplyr)
library(readxl)
library(stringr)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/2021 Exctracted accident form Yatin')
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
vehicle1<- read_xlsx('2_Vehicle_Table_1.xlsx',sheet ="2_Vehicle_Table")
victim1<- read_xlsx('3_Victim_Table_1.xlsx',sheet ="3_Victim_Table")
crash2<- read_xlsx('1_Crash_Table_2.xlsx',sheet ="1_Crash_Table")
vehicle2<- read_xlsx('2_Vehicle_Table_2.xlsx',sheet ="2_Vehicle_Table")
victim2<- read_xlsx('3_Victim_Table_2.xlsx',sheet ="3_Victim_Table")
crash3<- read_xlsx('1_Crash_Table_3.xlsx',sheet ="1_Crash_Table")
vehicle3<- read_xlsx('2_Vehicle_Table_3.xlsx',sheet ="2_Vehicle_Table")
victim3<- read_xlsx('3_Victim_Table_3.xlsx',sheet ="3_Victim_Table")
crash4<- read_xlsx('1_Crash_Table_4.xlsx',sheet ="1_Crash_Table")
vehicle4<- read_xlsx('2_Vehicle_Table_4.xlsx',sheet ="2_Vehicle_Table")
victim4<- read_xlsx('3_Victim_Table_4.xlsx',sheet ="3_Victim_Table")
##assigning crash_ID to vehicle and victim files
crash1$Crash_ID_new<- paste0(crash1$Crash_ID,crash1$FIR_No, crash1$Police_Station)
crash1_lookup<- subset(crash1, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle1<- vehicle1 %>% left_join(crash1_lookup, by="Crash_ID")
victim1<- victim1 %>% left_join(crash1_lookup, by="Crash_ID")
crash2$Crash_ID_new<- paste0(crash2$Crash_ID,crash2$FIR_No, crash2$Police_Station)
crash2_lookup<- subset(crash2, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle2<- vehicle2 %>% left_join(crash2_lookup, by="Crash_ID")
victim2<- victim2 %>% left_join(crash2_lookup, by="Crash_ID")
crash3$Crash_ID_new<- paste0(crash3$Crash_ID,crash3$FIR_No, crash3$Police_Station)
crash3_lookup<- subset(crash3, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle3<- vehicle3 %>% left_join(crash3_lookup, by="Crash_ID")
victim3<- victim3 %>% left_join(crash3_lookup, by="Crash_ID")
crash4$Crash_ID_new<- paste0(crash4$Crash_ID,crash4$FIR_No, crash4$Police_Station)
crash4_lookup<- subset(crash4, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle4<- vehicle4 %>% left_join(crash4_lookup, by="Crash_ID")
victim4<- victim4 %>% left_join(crash4_lookup, by="Crash_ID")
crash<- rbind(crash1, crash2,crash3,crash4)
vehicle<- rbind(vehicle1, vehicle2,vehicle3,vehicle4)
victim<- rbind(victim1, victim2,victim3,victim4)
#assigning crash_ID to those vehicle where it is not available
x<-unique(vehicle$Vehicle_ID[which(is.na(vehicle$Crash_ID))])
victim$Crash_ID_new[which(victim$Vehicle_ID %in% x)]
##reading file that has police station names and districts
pstation<- read.csv("PS_lookup.csv")
#joining crash file with police station look up file for district, state and police station names (for Raipur and Balod)
colnames(pstation)[1]<-"Police_Station"
crash<- crash %>% left_join(pstation, by="Police_Station")
crash_lookup<- crash[,c("Crash_ID_new", "FIR_No", "Police_Station", "Time_Of_Crash", "Date_Of_Crash", "Crash_Severity", "Collision_Type", "PS_Dist", "PS_State", "PS_Name", "Note", "Road_1", "Road_2", "Road_3", "Distance_From_Landmark")]
##adding crash details to vehicle file
vehicle <- vehicle %>% left_join(crash_lookup, by="Crash_ID_new")
vehicle$Vehicle_ID_new<- paste0(vehicle$Crash_ID_new,vehicle$Vehicle_ID)
victim$Vehicle_ID_new<- paste0(victim$Crash_ID_new,victim$Vehicle_ID)
victim<- victim[,-which(colnames(victim) %in% c("Vehicle_ID", "Crash_ID", "Crash_ID_new"))]
victim <- victim %>% left_join(vehicle, by="Vehicle_ID_new")
victim$Impacting_VehOrObject[which(victim$Road_User=="Pedestrian" & victim$Impacting_VehOrObject=="Pedestrian")]<- victim$Vehicle_Type[which(victim$Road_User=="Pedestrian" & victim$Impacting_VehOrObject=="Pedestrian")]
victim$Vehicle_Type[which(victim$Road_User=="Pedestrian" )]<- "Pedestrian"
victim_f<- victim[which(victim$Injury_Category %in% c("Fatal Injury with Offsite Death","Fatal Injury with Onsite Death")),]
View(victim_f[,c("Crash_ID_new", "Road_User","Injury_Category", "Vehicle_Occupant_Type", "Vehicle_Type","Impacting_VehOrObject")])
View(victim_f %>% group_by(Vehicle_Type) %>% summarise(n()))
View(victim)
sum(is.na(victim$Crash_ID_new))
victim[which(is.na(victim$Crash_ID_new)),]
View(victim[which(is.na(victim$Crash_ID_new)),])
library(dplyr)
library(readxl)
library(stringr)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/2021 Exctracted accident form Yatin')
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
vehicle1<- read_xlsx('2_Vehicle_Table_1.xlsx',sheet ="2_Vehicle_Table")
victim1<- read_xlsx('3_Victim_Table_1.xlsx',sheet ="3_Victim_Table")
crash2<- read_xlsx('1_Crash_Table_2.xlsx',sheet ="1_Crash_Table")
vehicle2<- read_xlsx('2_Vehicle_Table_2.xlsx',sheet ="2_Vehicle_Table")
victim2<- read_xlsx('3_Victim_Table_2.xlsx',sheet ="3_Victim_Table")
crash3<- read_xlsx('1_Crash_Table_3.xlsx',sheet ="1_Crash_Table")
vehicle3<- read_xlsx('2_Vehicle_Table_3.xlsx',sheet ="2_Vehicle_Table")
victim3<- read_xlsx('3_Victim_Table_3.xlsx',sheet ="3_Victim_Table")
crash4<- read_xlsx('1_Crash_Table_4.xlsx',sheet ="1_Crash_Table")
vehicle4<- read_xlsx('2_Vehicle_Table_4.xlsx',sheet ="2_Vehicle_Table")
victim4<- read_xlsx('3_Victim_Table_4.xlsx',sheet ="3_Victim_Table")
##assigning crash_ID to vehicle and victim files
crash1$Crash_ID_new<- paste0(crash1$Crash_ID,crash1$FIR_No, crash1$Police_Station)
crash1_lookup<- subset(crash1, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle1<- vehicle1 %>% left_join(crash1_lookup, by="Crash_ID")
victim1<- victim1 %>% left_join(crash1_lookup, by="Crash_ID")
crash2$Crash_ID_new<- paste0(crash2$Crash_ID,crash2$FIR_No, crash2$Police_Station)
crash2_lookup<- subset(crash2, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle2<- vehicle2 %>% left_join(crash2_lookup, by="Crash_ID")
victim2<- victim2 %>% left_join(crash2_lookup, by="Crash_ID")
crash3$Crash_ID_new<- paste0(crash3$Crash_ID,crash3$FIR_No, crash3$Police_Station)
crash3_lookup<- subset(crash3, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle3<- vehicle3 %>% left_join(crash3_lookup, by="Crash_ID")
victim3<- victim3 %>% left_join(crash3_lookup, by="Crash_ID")
crash4$Crash_ID_new<- paste0(crash4$Crash_ID,crash4$FIR_No, crash4$Police_Station)
crash4_lookup<- subset(crash4, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle4<- vehicle4 %>% left_join(crash4_lookup, by="Crash_ID")
victim4<- victim4 %>% left_join(crash4_lookup, by="Crash_ID")
crash<- rbind(crash1, crash2,crash3,crash4)
vehicle<- rbind(vehicle1, vehicle2,vehicle3,vehicle4)
victim<- rbind(victim1, victim2,victim3,victim4)
sum(is.na(victim$Crash_ID))
sum(is.na(vehicle$Crash_ID))
vehicle
View(vehicle)
View(vehicle[which(is.na(vehicle$Crash_ID)),])
View(victim[which(is.na(victim$Crash_ID)),])
pstation<- read.csv("PS_lookup.csv")
#joining crash file with police station look up file for district, state and police station names (for Raipur and Balod)
colnames(pstation)[1]<-"Police_Station"
crash<- crash %>% left_join(pstation, by="Police_Station")
crash_lookup<- crash[,c("Crash_ID_new", "FIR_No", "Police_Station", "Time_Of_Crash", "Date_Of_Crash", "Crash_Severity", "Collision_Type", "PS_Dist", "PS_State", "PS_Name", "Note", "Road_1", "Road_2", "Road_3", "Distance_From_Landmark")]
##adding crash details to vehicle file
vehicle <- vehicle %>% left_join(crash_lookup, by="Crash_ID_new")
vehicle$Vehicle_ID_new<- paste0(vehicle$Crash_ID_new,vehicle$Vehicle_ID)
victim$Vehicle_ID_new<- paste0(victim$Crash_ID_new,victim$Vehicle_ID)
victim<- victim[,-which(colnames(victim) %in% c("Vehicle_ID", "Crash_ID", "Crash_ID_new"))]
View(victim[which(is.na(victim$Crash_ID)),])
victim <- victim %>% left_join(vehicle, by="Vehicle_ID_new")
View(victim[which(is.na(victim$Crash_ID)),])
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/2021 Exctracted accident form Yatin')
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
vehicle1<- read_xlsx('2_Vehicle_Table_1.xlsx',sheet ="2_Vehicle_Table")
victim1<- read_xlsx('3_Victim_Table_1.xlsx',sheet ="3_Victim_Table")
crash2<- read_xlsx('1_Crash_Table_2.xlsx',sheet ="1_Crash_Table")
vehicle2<- read_xlsx('2_Vehicle_Table_2.xlsx',sheet ="2_Vehicle_Table")
victim2<- read_xlsx('3_Victim_Table_2.xlsx',sheet ="3_Victim_Table")
crash3<- read_xlsx('1_Crash_Table_3.xlsx',sheet ="1_Crash_Table")
vehicle3<- read_xlsx('2_Vehicle_Table_3.xlsx',sheet ="2_Vehicle_Table")
victim3<- read_xlsx('3_Victim_Table_3.xlsx',sheet ="3_Victim_Table")
crash4<- read_xlsx('1_Crash_Table_4.xlsx',sheet ="1_Crash_Table")
vehicle4<- read_xlsx('2_Vehicle_Table_4.xlsx',sheet ="2_Vehicle_Table")
victim4<- read_xlsx('3_Victim_Table_4.xlsx',sheet ="3_Victim_Table")
##assigning crash_ID to vehicle and victim files
crash1$Crash_ID_new<- paste0(crash1$Crash_ID,crash1$FIR_No, crash1$Police_Station)
crash1_lookup<- subset(crash1, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle1<- vehicle1 %>% left_join(crash1_lookup, by="Crash_ID")
victim1<- victim1 %>% left_join(crash1_lookup, by="Crash_ID")
crash2$Crash_ID_new<- paste0(crash2$Crash_ID,crash2$FIR_No, crash2$Police_Station)
crash2_lookup<- subset(crash2, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle2<- vehicle2 %>% left_join(crash2_lookup, by="Crash_ID")
victim2<- victim2 %>% left_join(crash2_lookup, by="Crash_ID")
crash3$Crash_ID_new<- paste0(crash3$Crash_ID,crash3$FIR_No, crash3$Police_Station)
crash3_lookup<- subset(crash3, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle3<- vehicle3 %>% left_join(crash3_lookup, by="Crash_ID")
victim3<- victim3 %>% left_join(crash3_lookup, by="Crash_ID")
crash4$Crash_ID_new<- paste0(crash4$Crash_ID,crash4$FIR_No, crash4$Police_Station)
crash4_lookup<- subset(crash4, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle4<- vehicle4 %>% left_join(crash4_lookup, by="Crash_ID")
victim4<- victim4 %>% left_join(crash4_lookup, by="Crash_ID")
crash<- rbind(crash1, crash2,crash3,crash4)
vehicle<- rbind(vehicle1, vehicle2,vehicle3,vehicle4)
victim<- rbind(victim1, victim2,victim3,victim4)
#assigning crash_ID to those vehicle where it is not available
x<-unique(vehicle$Vehicle_ID[which(is.na(vehicle$Crash_ID))])
victim$Crash_ID_new[which(victim$Vehicle_ID %in% x)]
##reading file that has police station names and districts
pstation<- read.csv("PS_lookup.csv")
#joining crash file with police station look up file for district, state and police station names (for Raipur and Balod)
colnames(pstation)[1]<-"Police_Station"
crash<- crash %>% left_join(pstation, by="Police_Station")
crash_lookup<- crash[,c("Crash_ID_new", "FIR_No", "Police_Station", "Time_Of_Crash", "Date_Of_Crash", "Crash_Severity", "Collision_Type", "PS_Dist", "PS_State", "PS_Name", "Note", "Road_1", "Road_2", "Road_3", "Distance_From_Landmark")]
##adding crash details to vehicle file
vehicle <- vehicle %>% left_join(crash_lookup, by="Crash_ID_new")
vehicle$Vehicle_ID_new<- paste0(vehicle$Crash_ID_new,vehicle$Vehicle_ID)
victim$Vehicle_ID_new<- paste0(victim$Crash_ID_new,victim$Vehicle_ID)
#victim<- victim[,-which(colnames(victim) %in% c("Vehicle_ID", "Crash_ID", "Crash_ID_new"))]
victim <- victim %>% left_join(vehicle, by="Vehicle_ID_new")
View(victim[which(is.na(victim$Crash_ID_new)),])
View(victim[which(is.na(victim$Crash_ID_new.x)),])
View(victim[which(is.na(victim$Crash_ID)),])
View(victim[which(is.na(victim$Crash_ID.x)),])
View(victim[which(is.na(victim$Crash_ID.y)),])
View(vehicle[which(is.na(vehicle$Crash_ID)),])
x<-unique(vehicle$Vehicle_ID[which(is.na(vehicle$Crash_ID))])
victim$Crash_ID_new[which(victim$Vehicle_ID %in% x)]
#assigning crash_ID to those vehicle where it is not available
x<-unique(vehicle$Vehicle_ID[which(is.na(vehicle$Crash_ID))])
x
victim$Crash_ID[which(victim$Vehicle_ID %in% x)]
victim$Crash_ID[which(victim$Vehicle_ID %in% x),]
library(dplyr)
library(readxl)
library(stringr)
setwd('C:/Users/goelr/Work/Datasets/Delhi crash database/2021 Exctracted accident form Yatin')
crash1<- read_xlsx('1_Crash_Table_1.xlsx',sheet ="1_Crash_Table")
vehicle1<- read_xlsx('2_Vehicle_Table_1.xlsx',sheet ="2_Vehicle_Table")
victim1<- read_xlsx('3_Victim_Table_1.xlsx',sheet ="3_Victim_Table")
crash2<- read_xlsx('1_Crash_Table_2.xlsx',sheet ="1_Crash_Table")
vehicle2<- read_xlsx('2_Vehicle_Table_2.xlsx',sheet ="2_Vehicle_Table")
victim2<- read_xlsx('3_Victim_Table_2.xlsx',sheet ="3_Victim_Table")
crash3<- read_xlsx('1_Crash_Table_3.xlsx',sheet ="1_Crash_Table")
vehicle3<- read_xlsx('2_Vehicle_Table_3.xlsx',sheet ="2_Vehicle_Table")
victim3<- read_xlsx('3_Victim_Table_3.xlsx',sheet ="3_Victim_Table")
crash4<- read_xlsx('1_Crash_Table_4.xlsx',sheet ="1_Crash_Table")
vehicle4<- read_xlsx('2_Vehicle_Table_4.xlsx',sheet ="2_Vehicle_Table")
victim4<- read_xlsx('3_Victim_Table_4.xlsx',sheet ="3_Victim_Table")
##assigning crash_ID to vehicle and victim files
crash1$Crash_ID_new<- paste0(crash1$Crash_ID,crash1$FIR_No, crash1$Police_Station)
crash1_lookup<- subset(crash1, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle1<- vehicle1 %>% left_join(crash1_lookup, by="Crash_ID")
victim1<- victim1 %>% left_join(crash1_lookup, by="Crash_ID")
crash2$Crash_ID_new<- paste0(crash2$Crash_ID,crash2$FIR_No, crash2$Police_Station)
crash2_lookup<- subset(crash2, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle2<- vehicle2 %>% left_join(crash2_lookup, by="Crash_ID")
victim2<- victim2 %>% left_join(crash2_lookup, by="Crash_ID")
crash3$Crash_ID_new<- paste0(crash3$Crash_ID,crash3$FIR_No, crash3$Police_Station)
crash3_lookup<- subset(crash3, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle3<- vehicle3 %>% left_join(crash3_lookup, by="Crash_ID")
victim3<- victim3 %>% left_join(crash3_lookup, by="Crash_ID")
crash4$Crash_ID_new<- paste0(crash4$Crash_ID,crash4$FIR_No, crash4$Police_Station)
crash4_lookup<- subset(crash4, select=c("Crash_ID", "Police_Station", "Crash_ID_new"))
vehicle4<- vehicle4 %>% left_join(crash4_lookup, by="Crash_ID")
victim4<- victim4 %>% left_join(crash4_lookup, by="Crash_ID")
crash<- rbind(crash1, crash2,crash3,crash4)
vehicle<- rbind(vehicle1, vehicle2,vehicle3,vehicle4)
victim<- rbind(victim1, victim2,victim3,victim4)
crash[which(is.na(crash$FIR_No))]
crash[which(is.na(crash$FIR_No)),]
crash[which(is.na(crash$Crash_ID)),]
crash[which(is.na(crash$Police_Station)),]
victim
